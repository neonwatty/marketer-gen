// =============================================================================
// ACCESSIBILITY ENHANCEMENTS - WCAG 2.1 AA COMPLIANCE
// =============================================================================
// Comprehensive accessibility features including screen reader support,
// keyboard navigation, high contrast mode, and reduced motion support
// =============================================================================

// =============================================================================
// ACCESSIBILITY VARIABLES
// =============================================================================

:root {
  // Focus indicators
  --focus-ring-width: 2px;
  --focus-ring-offset: 2px;
  --focus-ring-color: var(--brand-primary-500);
  --focus-ring-color-error: var(--color-status-error);
  --focus-ring-color-success: var(--color-status-success);
  --focus-ring-style: solid;
  --focus-ring-opacity: 1;
  
  // High contrast adjustments
  --high-contrast-border-width: 2px;
  --high-contrast-text-weight: 600;
  --high-contrast-shadow-opacity: 0.8;
  
  // Touch targets
  --touch-target-minimum: 44px;
  --touch-target-recommended: 48px;
  --touch-target-comfortable: 56px;
  
  // Motion preferences
  --motion-duration-short: 150ms;
  --motion-duration-medium: 300ms;
  --motion-duration-long: 500ms;
  --motion-easing: ease-out;
  
  // Skip link positioning
  --skip-link-top: 1rem;
  --skip-link-left: 1rem;
  --skip-link-z-index: 9999;
}

// =============================================================================
// SCREEN READER UTILITIES
// =============================================================================

// Screen reader only content
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

// Screen reader only on focus (for skip links)
.sr-only-focusable {
  @extend .sr-only;
  
  &:focus,
  &:active {
    position: static;
    width: auto;
    height: auto;
    margin: 0;
    overflow: visible;
    clip: auto;
    white-space: normal;
  }
}

// Hide from screen readers but keep visual
.aria-hidden {
  speak: none;
  
  &[aria-hidden="true"] {
    speak: none;
  }
}

// Announce live regions
.live-region {
  position: absolute;
  left: -10000px;
  width: 1px;
  height: 1px;
  overflow: hidden;
  
  &[aria-live="polite"] {
    speak: none;
  }
  
  &[aria-live="assertive"] {
    speak: none;
  }
}

// =============================================================================
// KEYBOARD NAVIGATION ENHANCEMENTS
// =============================================================================

// Enhanced focus styles for all interactive elements
*:focus-visible {
  outline: var(--focus-ring-width) var(--focus-ring-style) var(--focus-ring-color);
  outline-offset: var(--focus-ring-offset);
  border-radius: var(--radius-sm);
  position: relative;
  z-index: 1;
  
  // Remove default browser focus styles
  &:not(.focus-visible) {
    outline: none;
  }
}

// Keyboard navigation indicator
html.keyboard-navigation {
  *:focus {
    outline: var(--focus-ring-width) var(--focus-ring-style) var(--focus-ring-color);
    outline-offset: var(--focus-ring-offset);
  }
}

// Enhanced focus for form elements
input:focus-visible,
textarea:focus-visible,
select:focus-visible {
  outline: var(--focus-ring-width) var(--focus-ring-style) var(--focus-ring-color);
  outline-offset: var(--focus-ring-offset);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  
  &.input-error {
    outline-color: var(--focus-ring-color-error);
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
  }
  
  &.input-success {
    outline-color: var(--focus-ring-color-success);
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
  }
}

// Button focus styles
.btn:focus-visible {
  outline: var(--focus-ring-width) var(--focus-ring-style) var(--focus-ring-color);
  outline-offset: var(--focus-ring-offset);
  
  &.btn-primary {
    outline-color: white;
    box-shadow: 0 0 0 3px var(--brand-primary-300);
  }
  
  &.btn-secondary {
    outline-color: var(--focus-ring-color);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }
  
  &.btn-error {
    outline-color: white;
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.3);
  }
}

// Link focus styles
a:focus-visible {
  outline: var(--focus-ring-width) var(--focus-ring-style) var(--focus-ring-color);
  outline-offset: var(--focus-ring-offset);
  border-radius: var(--radius-sm);
  text-decoration: underline;
  text-decoration-thickness: 2px;
  text-underline-offset: 2px;
}

// Focus management for modals and overlays
.modal:focus-visible,
.dropdown:focus-visible {
  outline: var(--focus-ring-width) var(--focus-ring-style) var(--focus-ring-color);
  outline-offset: -2px; // Inside the element
}

// =============================================================================
// SKIP LINKS
// =============================================================================

.skip-links {
  position: absolute;
  top: var(--skip-link-top);
  left: var(--skip-link-left);
  z-index: var(--skip-link-z-index);
  
  .skip-link {
    @extend .sr-only-focusable;
    display: inline-block;
    padding: var(--space-2) var(--space-4);
    background-color: var(--color-surface-primary);
    color: var(--color-text-primary);
    border: 2px solid var(--focus-ring-color);
    border-radius: var(--radius-lg);
    font-weight: var(--weight-medium);
    text-decoration: none;
    box-shadow: var(--shadow-lg);
    margin-right: var(--space-2);
    
    &:focus,
    &:active {
      position: static;
      transform: translateY(0);
    }
    
    &:hover {
      background-color: var(--color-surface-secondary);
      text-decoration: underline;
    }
  }
}

// =============================================================================
// TOUCH TARGET ENHANCEMENTS
// =============================================================================

// Ensure minimum touch target sizes
.btn,
.input,
.select,
.textarea,
a[role="button"],
button,
[role="button"],
[tabindex="0"] {
  min-height: var(--touch-target-minimum);
  min-width: var(--touch-target-minimum);
  
  // Larger touch targets on touch devices
  @media (hover: none) and (pointer: coarse) {
    min-height: var(--touch-target-recommended);
    min-width: var(--touch-target-recommended);
  }
}

// Comfortable spacing for touch interfaces
@media (hover: none) and (pointer: coarse) {
  .btn-group .btn {
    margin-right: var(--space-1);
    
    &:last-child {
      margin-right: 0;
    }
  }
}

// =============================================================================
// HIGH CONTRAST MODE SUPPORT
// =============================================================================

@media (prefers-contrast: high) {
  :root {
    // Increase contrast ratios
    --color-text-primary: #000000;
    --color-text-secondary: #000000;
    --color-text-tertiary: #000000;
    --color-bg-primary: #ffffff;
    --color-surface-primary: #ffffff;
    
    // Strengthen borders
    --color-border-primary: #000000;
    --color-border-secondary: #000000;
    --high-contrast-border-width: 2px;
    
    // Enhance shadows
    --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.5);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
    
    // Strengthen focus indicators
    --focus-ring-width: 3px;
    --focus-ring-color: #000000;
  }
  
  // Strengthen all borders
  *,
  *::before,
  *::after {
    border-color: var(--color-border-primary) !important;
  }
  
  // Enhance button contrast
  .btn {
    border-width: var(--high-contrast-border-width);
    font-weight: var(--high-contrast-text-weight);
    
    &.btn-primary {
      background-color: #000000;
      color: #ffffff;
      border-color: #000000;
    }
    
    &.btn-secondary {
      background-color: #ffffff;
      color: #000000;
      border-color: #000000;
    }
  }
  
  // Enhance form elements
  .input,
  .textarea,
  .select {
    border-width: var(--high-contrast-border-width);
    border-color: #000000;
    
    &:focus {
      border-color: #000000;
      box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.3);
    }
  }
  
  // Enhance text contrast
  h1, h2, h3, h4, h5, h6,
  .text-heading-h1, .text-heading-h2, .text-heading-h3,
  .text-heading-h4, .text-heading-h5, .text-heading-h6 {
    color: #000000;
    font-weight: var(--high-contrast-text-weight);
  }
  
  // Enhance links
  a {
    color: #000000;
    text-decoration: underline;
    text-decoration-thickness: 2px;
    
    &:hover,
    &:focus {
      text-decoration-thickness: 3px;
      background-color: rgba(0, 0, 0, 0.1);
    }
  }
  
  // Enhance status colors
  .text-success { color: #000000; }
  .text-warning { color: #000000; }
  .text-error { color: #000000; }
  .text-info { color: #000000; }
  
  .alert {
    border-width: var(--high-contrast-border-width);
    border-color: #000000;
    
    &.alert-success { background-color: #ffffff; color: #000000; }
    &.alert-warning { background-color: #ffffff; color: #000000; }
    &.alert-error { background-color: #ffffff; color: #000000; }
    &.alert-info { background-color: #ffffff; color: #000000; }
  }
}

// =============================================================================
// REDUCED MOTION SUPPORT
// =============================================================================

@media (prefers-reduced-motion: reduce) {
  :root {
    // Disable or reduce animations
    --motion-duration-short: 0ms;
    --motion-duration-medium: 0ms;
    --motion-duration-long: 0ms;
    --transition-base: none;
    --transition-colors: none;
    --transition-transform: none;
    --transition-opacity: none;
  }
  
  // Remove all animations and transitions
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  
  // Disable auto-playing animations
  .loading-spinner,
  .loading-dots,
  .progress-animated {
    animation: none !important;
  }
  
  // Keep essential micro-interactions but make them instant
  .btn:hover,
  .btn:focus,
  .btn:active {
    transition: none;
    transform: none;
  }
  
  // Disable parallax and smooth scrolling
  .parallax {
    transform: none !important;
  }
  
  html {
    scroll-behavior: auto !important;
  }
}

// =============================================================================
// COLOR VISION DEFICIENCY SUPPORT
// =============================================================================

// Pattern-based visual cues for color-blind users
.status-indicator {
  position: relative;
  
  &.status-success::after {
    content: "✓";
    position: absolute;
    right: -1em;
    color: var(--color-status-success);
    font-weight: bold;
  }
  
  &.status-error::after {
    content: "✗";
    position: absolute;
    right: -1em;
    color: var(--color-status-error);
    font-weight: bold;
  }
  
  &.status-warning::after {
    content: "⚠";
    position: absolute;
    right: -1em;
    color: var(--color-status-warning);
    font-weight: bold;
  }
}

// Enhanced form validation with icons
.form-field {
  position: relative;
  
  &.field-error {
    .input {
      border-color: var(--color-status-error);
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc2626'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='M5.8 4.6L6.2 7.4M6 8.8v.01'/%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 0.75rem center;
      background-size: 1rem 1rem;
      padding-right: 2.5rem;
    }
  }
  
  &.field-success {
    .input {
      border-color: var(--color-status-success);
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%2310b981'%3e%3cpath d='M3.5 6L5 7.5L8.5 4'/%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 0.75rem center;
      background-size: 1rem 1rem;
      padding-right: 2.5rem;
    }
  }
}

// =============================================================================
// FONT SIZE PREFERENCES
// =============================================================================

@media (prefers-font-size: large) {
  :root {
    // Increase base font sizes
    --type-base-size: clamp(1rem, 1.25vw + 0.75rem, 1.5rem);
    --type-sm: clamp(1rem, 1.1vw + 0.6rem, 1.25rem);
    --type-lg: clamp(1.25rem, 1.5vw + 0.85rem, 1.75rem);
    
    // Adjust heading sizes
    --heading-1: clamp(2.5rem, 5vw + 2rem, 5rem);
    --heading-2: clamp(2rem, 4vw + 1.75rem, 4rem);
    --heading-3: clamp(1.75rem, 3.5vw + 1.25rem, 3rem);
    
    // Increase line heights for better readability
    --leading-body: 1.7;
    --leading-relaxed: 1.8;
  }
  
  // Adjust component sizes
  .btn {
    font-size: var(--type-base);
    padding: var(--space-4) var(--space-6);
  }
  
  .input,
  .textarea,
  .select {
    font-size: var(--type-base);
    padding: var(--space-4);
  }
}

// =============================================================================
// DARK MODE ACCESSIBILITY ENHANCEMENTS
// =============================================================================

[data-theme="dark"] {
  // Enhanced contrast for dark mode
  --color-text-primary: #f9fafb;
  --color-text-secondary: #e5e7eb;
  --color-text-tertiary: #d1d5db;
  
  // Stronger focus indicators for dark backgrounds
  --focus-ring-color: #60a5fa;
  
  // Enhanced border contrast
  --color-border-primary: #4b5563;
  --color-border-secondary: #6b7280;
  
  // Improved form field contrast
  .input,
  .textarea,
  .select {
    background-color: var(--color-neutral-800);
    border-color: var(--color-neutral-600);
    color: var(--color-text-primary);
    
    &::placeholder {
      color: var(--color-neutral-400);
    }
    
    &:focus {
      border-color: var(--brand-primary-400);
      box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
    }
  }
  
  // Enhanced button contrast
  .btn-secondary {
    background-color: var(--color-neutral-700);
    border-color: var(--color-neutral-600);
    color: var(--color-text-primary);
    
    &:hover {
      background-color: var(--color-neutral-600);
      border-color: var(--color-neutral-500);
    }
  }
}

// =============================================================================
// ACCESSIBILITY UTILITIES
// =============================================================================

// Focus trap for modals and dropdowns
.focus-trap {
  &:focus {
    outline: none;
  }
}

// Accessible hiding (better than display: none for screen readers)
.visually-hidden {
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  overflow: hidden !important;
  clip: rect(0, 0, 0, 0) !important;
  white-space: nowrap !important;
  border: 0 !important;
}

// Accessible show/hide
.accessible-hide {
  visibility: hidden;
  opacity: 0;
  pointer-events: none;
}

.accessible-show {
  visibility: visible;
  opacity: 1;
  pointer-events: auto;
}

// Loading states with accessible announcements
.loading-accessible {
  position: relative;
  
  &::after {
    content: "Loading...";
    position: absolute;
    left: -10000px;
    speak: normal;
  }
  
  &[aria-busy="true"]::after {
    speak: normal;
  }
}

// Accessible tooltips
.tooltip-accessible {
  position: relative;
  
  .tooltip-content {
    // Ensure tooltips are keyboard accessible
    &:not([aria-hidden="true"]) {
      visibility: visible;
      opacity: 1;
    }
  }
  
  &:focus-within .tooltip-content {
    visibility: visible;
    opacity: 1;
  }
}

// Error message styling for better accessibility
.error-message {
  color: var(--color-status-error);
  font-size: var(--type-sm);
  font-weight: var(--weight-medium);
  margin-top: var(--space-1);
  display: flex;
  align-items: flex-start;
  gap: var(--space-1);
  
  &::before {
    content: "⚠";
    flex-shrink: 0;
    font-weight: bold;
  }
}

// Success message styling
.success-message {
  color: var(--color-status-success);
  font-size: var(--type-sm);
  font-weight: var(--weight-medium);
  margin-top: var(--space-1);
  display: flex;
  align-items: flex-start;
  gap: var(--space-1);
  
  &::before {
    content: "✓";
    flex-shrink: 0;
    font-weight: bold;
  }
}

// =============================================================================
// PRINT ACCESSIBILITY
// =============================================================================

@media print {
  // Ensure good contrast for printing
  * {
    color: #000 !important;
    background: transparent !important;
    box-shadow: none !important;
  }
  
  // Show URLs for links
  a[href]::after {
    content: " (" attr(href) ")";
    font-size: 0.8em;
    color: #666;
  }
  
  // Ensure form fields are visible
  .input,
  .textarea,
  .select {
    border: 1px solid #000 !important;
    background: white !important;
  }
  
  // Hide interactive elements that don't make sense in print
  .btn,
  .dropdown,
  .modal,
  .tooltip {
    display: none !important;
  }
  
  // Ensure headings don't break across pages
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
    page-break-inside: avoid;
  }
}

// =============================================================================
// RESPONSIVE ACCESSIBILITY
// =============================================================================

// Mobile accessibility enhancements
@media (max-width: 640px) {
  // Larger touch targets on mobile
  .btn,
  .input,
  .select,
  a[role="button"],
  button {
    min-height: var(--touch-target-recommended);
    min-width: var(--touch-target-recommended);
  }
  
  // Better spacing for mobile interactions
  .form-field {
    margin-bottom: var(--space-6);
  }
  
  // Enhanced focus indicators for mobile
  *:focus-visible {
    outline-width: 3px;
    outline-offset: 3px;
  }
}

// Large screen accessibility
@media (min-width: 1200px) {
  // Maintain reasonable line lengths for readability
  .content-container {
    max-width: 65ch; // Optimal reading width
  }
  
  // Ensure focus indicators are visible on large screens
  *:focus-visible {
    outline-width: 3px;
  }
}