<div class="row">
  <div class="col-sm-12">
    <h1><i class="fa fa-cogs"></i> System Maintenance</h1>
    <p class="text-muted">Perform system cleanup and maintenance operations.</p>
  </div>
</div>

<div class="row">
  <div class="col-sm-8">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Database Cleanup Statistics</h3>
      </div>
      <div class="panel-body">
        <div class="row">
          <div class="col-sm-4">
            <div class="well text-center">
              <h4><%= @cleanup_stats[:old_activities] %></h4>
              <p>Old Activities<br><small>(older than 30 days)</small></p>
            </div>
          </div>
          <div class="col-sm-4">
            <div class="well text-center">
              <h4><%= @cleanup_stats[:expired_sessions] %></h4>
              <p>Expired Sessions</p>
            </div>
          </div>
          <div class="col-sm-4">
            <div class="well text-center">
              <h4><%= @cleanup_stats[:old_audit_logs] %></h4>
              <p>Old Audit Logs<br><small>(older than 90 days)</small></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-sm-4">
    <div class="panel panel-warning">
      <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-exclamation-triangle"></i> Warning</h3>
      </div>
      <div class="panel-body">
        <p><strong>Important:</strong> These operations cannot be undone. Please ensure you have appropriate backups before proceeding.</p>
        <p>Maintenance operations will be logged in the admin audit trail.</p>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-sm-12">
    <div class="panel panel-primary">
      <div class="panel-heading">
        <h3 class="panel-title">Maintenance Actions</h3>
      </div>
      <div class="panel-body">
        <div class="row">
          <div class="col-sm-6">
            <%= form_with url: rails_admin.system_maintenance_path, method: :post, local: true do |f| %>
              <%= hidden_field_tag :maintenance_action, 'cleanup_old_activities' %>
              <div class="form-group">
                <h4><i class="fa fa-chart-line"></i> Clean Old Activities</h4>
                <p>Remove activity records older than 30 days to improve database performance.</p>
                <p><strong>Records to be deleted:</strong> <%= @cleanup_stats[:old_activities] %></p>
                <%= f.submit "Clean Old Activities", 
                    class: "btn btn-warning", 
                    data: { 
                      confirm: "Are you sure you want to delete #{@cleanup_stats[:old_activities]} old activity records?" 
                    } %>
              </div>
            <% end %>
          </div>
          
          <div class="col-sm-6">
            <%= form_with url: rails_admin.system_maintenance_path, method: :post, local: true do |f| %>
              <%= hidden_field_tag :maintenance_action, 'cleanup_expired_sessions' %>
              <div class="form-group">
                <h4><i class="fa fa-user-clock"></i> Clean Expired Sessions</h4>
                <p>Remove expired user sessions from the database.</p>
                <p><strong>Records to be deleted:</strong> <%= @cleanup_stats[:expired_sessions] %></p>
                <%= f.submit "Clean Expired Sessions", 
                    class: "btn btn-warning", 
                    data: { 
                      confirm: "Are you sure you want to delete #{@cleanup_stats[:expired_sessions]} expired sessions?" 
                    } %>
              </div>
            <% end %>
          </div>
        </div>
        
        <div class="row">
          <div class="col-sm-6">
            <%= form_with url: rails_admin.system_maintenance_path, method: :post, local: true do |f| %>
              <%= hidden_field_tag :maintenance_action, 'cleanup_old_audit_logs' %>
              <div class="form-group">
                <h4><i class="fa fa-history"></i> Clean Old Audit Logs</h4>
                <p>Remove audit logs older than 90 days. Keep recent logs for compliance.</p>
                <p><strong>Records to be deleted:</strong> <%= @cleanup_stats[:old_audit_logs] %></p>
                <%= f.submit "Clean Old Audit Logs", 
                    class: "btn btn-warning", 
                    data: { 
                      confirm: "Are you sure you want to delete #{@cleanup_stats[:old_audit_logs]} old audit logs?" 
                    } %>
              </div>
            <% end %>
          </div>
          
          <div class="col-sm-6">
            <%= form_with url: rails_admin.system_maintenance_path, method: :post, local: true do |f| %>
              <%= hidden_field_tag :maintenance_action, 'full_cleanup' %>
              <div class="form-group">
                <h4><i class="fa fa-broom"></i> Full System Cleanup</h4>
                <p><strong>Performs all cleanup operations at once.</strong></p>
                <p>This will delete all old activities, expired sessions, and old audit logs.</p>
                <%= f.submit "Full System Cleanup", 
                    class: "btn btn-danger", 
                    data: { 
                      confirm: "Are you sure you want to perform a full system cleanup? This will delete:\n- #{@cleanup_stats[:old_activities]} old activities\n- #{@cleanup_stats[:expired_sessions]} expired sessions\n- #{@cleanup_stats[:old_audit_logs]} old audit logs\n\nThis action cannot be undone!" 
                    } %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-sm-12">
    <div class="panel panel-info">
      <div class="panel-heading">
        <h3 class="panel-title">Maintenance Schedule Recommendations</h3>
      </div>
      <div class="panel-body">
        <ul>
          <li><strong>Daily:</strong> Clean expired sessions to maintain security</li>
          <li><strong>Weekly:</strong> Monitor old activities and clean if database grows too large</li>
          <li><strong>Monthly:</strong> Clean old audit logs to maintain compliance while optimizing storage</li>
          <li><strong>As Needed:</strong> Full cleanup during maintenance windows</li>
        </ul>
        <p><em>Consider automating these tasks using rake tasks or background jobs for production environments.</em></p>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-sm-12">
    <div class="form-actions">
      <%= link_to "Back to Dashboard", rails_admin.dashboard_path, class: "btn btn-default" %>
    </div>
  </div>
</div>