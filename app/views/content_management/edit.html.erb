<div class="container mx-auto px-4 py-8">
  <div class="max-w-6xl mx-auto">
    <!-- Header -->
    <div class="flex justify-between items-center mb-8">
      <div>
        <h1 class="text-3xl font-bold text-gray-900">Edit Content</h1>
        <p class="text-gray-600 mt-2">Use the rich text editor and live preview to perfect your content</p>
      </div>
      <%= link_to content_management_index_path, 
          class: "text-gray-600 hover:text-gray-900 inline-flex items-center" do %>
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
        </svg>
        Back to Content List
      <% end %>
    </div>

    <%= form_with model: @content_request, url: content_management_path(@content_request), 
                  local: true, class: "space-y-8" do |form| %>
      
      <!-- Error Messages -->
      <% if @content_request.errors.any? %>
        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
          <div class="flex">
            <svg class="w-5 h-5 text-red-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div class="ml-3">
              <h3 class="text-sm font-medium text-red-800">Please fix the following errors:</h3>
              <div class="mt-2 text-sm text-red-700">
                <ul class="list-disc pl-5 space-y-1">
                  <% @content_request.errors.full_messages.each do |message| %>
                    <li><%= message %></li>
                  <% end %>
                </ul>
              </div>
            </div>
          </div>
        </div>
      <% end %>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <!-- Left Column: Editor -->
        <div class="space-y-6">
          <div class="bg-white rounded-lg shadow-sm border">
            <div class="px-6 py-4 border-b border-gray-200">
              <h2 class="text-lg font-semibold text-gray-900">Content Editor</h2>
              <p class="text-sm text-gray-600 mt-1">Create and edit your content with rich text formatting</p>
            </div>
            
            <!-- Rich Text Editor -->
            <div data-controller="rich-text-editor"
                 data-rich-text-editor-content-value="<%= @content_response.generated_content %>"
                 data-rich-text-editor-channel-value="<%= @content_request.content_type %>"
                 data-rich-text-editor-placeholder-value="Start writing your content..."
                 class="rich-text-editor-container">
              
              <!-- Toolbar -->
              <div data-rich-text-editor-target="toolbar" class="border-b border-gray-200 p-4 bg-gray-50 flex flex-wrap items-center gap-1">
                <!-- Format buttons -->
                <button type="button" 
                        data-action="click->rich-text-editor#toggleBold"
                        class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors"
                        title="Bold">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M3 5a1 1 0 011-1h5.5a2.5 2.5 0 110 5H4a1 1 0 01-1-1V5zM4 8h5.5a2.5 2.5 0 110 5H4V8z"></path>
                  </svg>
                </button>
                
                <button type="button" 
                        data-action="click->rich-text-editor#toggleItalic"
                        class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors"
                        title="Italic">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M8.25 3.75H11.25L9.75 16.25H6.75L8.25 3.75Z"></path>
                  </svg>
                </button>
                
                <button type="button" 
                        data-action="click->rich-text-editor#toggleStrike"
                        class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors"
                        title="Strikethrough">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 12h12M8 7.5c0-1.933 1.567-3.5 3.5-3.5S15 5.567 15 7.5c0 .433-.1.849-.28 1.216M16 16.5c0 1.933-1.567 3.5-3.5 3.5S9 18.433 9 16.5"></path>
                  </svg>
                </button>
                
                <button type="button" 
                        data-action="click->rich-text-editor#toggleCode"
                        class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors"
                        title="Code">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                  </svg>
                </button>
                
                <div class="w-px h-6 bg-gray-300 mx-1"></div>
                
                <!-- Heading buttons -->
                <button type="button" 
                        data-action="click->rich-text-editor#setHeading"
                        data-level="1"
                        class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors text-sm font-semibold"
                        title="Heading 1">
                  H1
                </button>
                
                <button type="button" 
                        data-action="click->rich-text-editor#setHeading"
                        data-level="2"
                        class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors text-sm font-semibold"
                        title="Heading 2">
                  H2
                </button>
                
                <button type="button" 
                        data-action="click->rich-text-editor#setHeading"
                        data-level="3"
                        class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors text-sm font-semibold"
                        title="Heading 3">
                  H3
                </button>
                
                <div class="w-px h-6 bg-gray-300 mx-1"></div>
                
                <!-- List buttons -->
                <button type="button" 
                        data-action="click->rich-text-editor#toggleBulletList"
                        class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors"
                        title="Bullet List">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                  </svg>
                </button>
                
                <button type="button" 
                        data-action="click->rich-text-editor#toggleOrderedList"
                        class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors"
                        title="Numbered List">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h6l4 4v4.172a2 2 0 01-.586 1.414z"></path>
                  </svg>
                </button>
                
                <button type="button" 
                        data-action="click->rich-text-editor#toggleBlockquote"
                        class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors"
                        title="Quote">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M3 3.5A1.5 1.5 0 014.5 2h11A1.5 1.5 0 0117 3.5v13a1.5 1.5 0 01-1.5 1.5h-11A1.5 1.5 0 013 16.5v-13zm2.5 0v13h9v-13h-9z"></path>
                  </svg>
                </button>
                
                <div class="w-px h-6 bg-gray-300 mx-1"></div>
                
                <!-- Undo/Redo -->
                <button type="button" 
                        data-action="click->rich-text-editor#undo"
                        class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors"
                        title="Undo">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path>
                  </svg>
                </button>
                
                <button type="button" 
                        data-action="click->rich-text-editor#redo"
                        class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors"
                        title="Redo">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 10h-10a8 8 0 00-8 8v2m18-10l-6 6m6-6l-6-6"></path>
                  </svg>
                </button>
                
                <div class="w-px h-6 bg-gray-300 mx-1"></div>
                
                <!-- Export buttons -->
                <button type="button" 
                        data-action="click->rich-text-editor#exportHTML"
                        class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors text-xs"
                        title="Export HTML">
                  HTML
                </button>
                
                <button type="button" 
                        data-action="click->rich-text-editor#exportMarkdown"
                        class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors text-xs"
                        title="Export Markdown">
                  MD
                </button>
              </div>
              
              <!-- Editor -->
              <div data-rich-text-editor-target="editor" 
                   class="min-h-[400px] p-6 prose prose-sm max-w-none focus:outline-none">
              </div>
              
              <!-- Hidden field to store content -->
              <%= form.hidden_field :content_response_attributes, 
                                    data: { rich_text_editor_target: "content" } %>
              
              <!-- Error display -->
              <div data-rich-text-editor-target="error" 
                   class="hidden bg-red-50 border-t border-red-200 p-4 text-red-700 text-sm">
              </div>
            </div>
          </div>
          
          <!-- Content Settings -->
          <div class="bg-white rounded-lg shadow-sm border">
            <div class="px-6 py-4 border-b border-gray-200">
              <h3 class="text-lg font-semibold text-gray-900">Content Settings</h3>
            </div>
            <div class="px-6 py-4 space-y-4">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <%= form.label :campaign_name, class: "block text-sm font-medium text-gray-700 mb-1" %>
                  <%= form.text_field :campaign_name, 
                      class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
                </div>
                
                <div>
                  <%= form.label :content_type, "Channel", class: "block text-sm font-medium text-gray-700 mb-1" %>
                  <%= form.select :content_type, 
                      options_for_select(@channels.map { |c| [c.humanize, c] }, @content_request.content_type),
                      { prompt: "Select a channel" },
                      { class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                        data: { rich_text_editor_target: "channelSelector" } } %>
                </div>
              </div>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <%= form.label :tone, class: "block text-sm font-medium text-gray-700 mb-1" %>
                  <%= form.select :tone, 
                      options_for_select([
                        ['Professional', 'professional'],
                        ['Friendly', 'friendly'],
                        ['Casual', 'casual'],
                        ['Formal', 'formal'],
                        ['Enthusiastic', 'enthusiastic'],
                        ['Conversational', 'conversational']
                      ], @content_request.tone),
                      { prompt: "Select tone" },
                      { class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" } %>
                </div>
                
                <div>
                  <%= form.label :content_length, class: "block text-sm font-medium text-gray-700 mb-1" %>
                  <%= form.select :content_length, 
                      options_for_select([
                        ['Short', 'short'],
                        ['Medium', 'medium'],
                        ['Long', 'long']
                      ], @content_request.content_length),
                      { prompt: "Select length" },
                      { class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" } %>
                </div>
              </div>
              
              <div>
                <%= form.label :target_audience, class: "block text-sm font-medium text-gray-700 mb-1" %>
                <%= form.text_area :target_audience, rows: 2,
                    class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
              </div>
              
              <div>
                <%= form.label :brand_context, class: "block text-sm font-medium text-gray-700 mb-1" %>
                <%= form.text_area :brand_context, rows: 3,
                    class: "w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Right Column: Preview -->
        <div class="space-y-6">
          <div class="bg-white rounded-lg shadow-sm border">
            <div class="px-6 py-4 border-b border-gray-200">
              <div class="flex items-center justify-between">
                <div>
                  <h3 class="text-lg font-semibold text-gray-900">Live Preview</h3>
                  <p class="text-sm text-gray-600 mt-1">See how your content looks across different channels</p>
                </div>
                <button type="button" 
                        data-action="click->rich-text-editor#toggleMobilePreview"
                        class="text-sm text-gray-600 hover:text-gray-900 inline-flex items-center">
                  <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a1 1 0 001-1V4a1 1 0 00-1-1H8a1 1 0 00-1 1v16a1 1 0 001 1z"></path>
                  </svg>
                  Mobile View
                </button>
              </div>
            </div>
            
            <div class="p-6">
              <div data-rich-text-editor-target="preview" class="preview-container min-h-[400px]">
                <!-- Preview content will be rendered here -->
              </div>
            </div>
          </div>
          
          <!-- Quick Actions -->
          <div class="bg-white rounded-lg shadow-sm border">
            <div class="px-6 py-4 border-b border-gray-200">
              <h3 class="text-lg font-semibold text-gray-900">Quick Actions</h3>
            </div>
            <div class="px-6 py-4 space-y-3">
              <button type="button" 
                      data-action="click->rich-text-editor#clearContent"
                      class="w-full text-left px-4 py-2 text-sm text-gray-600 hover:bg-gray-50 rounded-md transition-colors">
                🗑️ Clear Content
              </button>
              
              <button type="button" 
                      data-content="<h2>Key Benefits</h2><ul><li>Benefit 1</li><li>Benefit 2</li><li>Benefit 3</li></ul>"
                      data-action="click->rich-text-editor#insertContent"
                      class="w-full text-left px-4 py-2 text-sm text-gray-600 hover:bg-gray-50 rounded-md transition-colors">
                📋 Insert Benefits Template
              </button>
              
              <button type="button" 
                      data-content="<blockquote><em>&quot;Customer testimonial goes here...&quot;</em><br><strong>- Customer Name</strong></blockquote>"
                      data-action="click->rich-text-editor#insertContent"
                      class="w-full text-left px-4 py-2 text-sm text-gray-600 hover:bg-gray-50 rounded-md transition-colors">
                💬 Insert Testimonial
              </button>
              
              <button type="button" 
                      data-content="<p><strong>Call to Action:</strong> Ready to get started? <a href=\"#\">Learn more →</a></p>"
                      data-action="click->rich-text-editor#insertContent"
                      class="w-full text-left px-4 py-2 text-sm text-gray-600 hover:bg-gray-50 rounded-md transition-colors">
                🎯 Insert Call to Action
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Action Buttons -->
      <div class="flex justify-between items-center pt-8 border-t border-gray-200">
        <div class="flex space-x-3">
          <%= link_to content_management_path(@content_request), 
              class: "text-gray-600 hover:text-gray-900 inline-flex items-center" do %>
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
            </svg>
            Cancel
          <% end %>
        </div>
        
        <div class="flex space-x-3">
          <%= form.submit "Regenerate Content", 
              name: "regenerate_content",
              class: "bg-yellow-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-yellow-700 transition-colors inline-flex items-center" %>
          
          <%= form.submit "Save Content", 
              class: "bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors inline-flex items-center" %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<style>
  .rich-text-editor-container .ProseMirror {
    outline: none;
  }
  
  .rich-text-editor-container .ProseMirror h1,
  .rich-text-editor-container .ProseMirror h2,
  .rich-text-editor-container .ProseMirror h3 {
    line-height: 1.2;
    margin-top: 1em;
    margin-bottom: 0.5em;
  }
  
  .rich-text-editor-container .ProseMirror h1 {
    font-size: 1.5em;
    font-weight: bold;
  }
  
  .rich-text-editor-container .ProseMirror h2 {
    font-size: 1.25em;
    font-weight: bold;
  }
  
  .rich-text-editor-container .ProseMirror h3 {
    font-size: 1.125em;
    font-weight: bold;
  }
  
  .rich-text-editor-container .ProseMirror p {
    margin-bottom: 1em;
  }
  
  .rich-text-editor-container .ProseMirror ul,
  .rich-text-editor-container .ProseMirror ol {
    margin: 1em 0;
    padding-left: 2em;
  }
  
  .rich-text-editor-container .ProseMirror blockquote {
    margin: 1em 0;
    padding-left: 1em;
    border-left: 3px solid #e5e7eb;
    font-style: italic;
  }
  
  .rich-text-editor-container .is-active {
    background-color: #dbeafe;
    color: #1e40af;
  }
</style>