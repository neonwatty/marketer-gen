<%
  # Skeleton Card Partial
  # Usage: <%= render "shared/skeleton_card", lines: 3, avatar: true, width: "full" %>
  
  lines = local_assigns[:lines] || 3
  avatar = local_assigns[:avatar] || false
  width = local_assigns[:width] || "full"
  height = local_assigns[:height]
  classes = local_assigns[:classes] || ""
  id = local_assigns[:id]
  hidden = local_assigns[:hidden] || false
  
  # Width mappings
  width_classes = {
    "full" => "w-full",
    "1/2" => "w-1/2",
    "1/3" => "w-1/3", 
    "2/3" => "w-2/3",
    "1/4" => "w-1/4",
    "3/4" => "w-3/4",
    "sm" => "w-48",
    "md" => "w-64",
    "lg" => "w-80",
    "xl" => "w-96"
  }
  
  container_classes = [
    width_classes[width] || width_classes["full"],
    "animate-pulse",
    classes
  ].join(" ")
  
  container_classes += " hidden" if hidden
  container_classes += " #{height}" if height
%>

<div class="<%= container_classes %>" 
     <%= "id=\"#{id}\"".html_safe if id %>
     role="status" 
     aria-live="polite"
     aria-label="Loading content">
  
  <div class="bg-white rounded-lg border border-gray-200 p-4 space-y-4">
    <!-- Header with avatar -->
    <% if avatar %>
      <div class="flex items-center space-x-3">
        <!-- Avatar skeleton -->
        <div class="w-10 h-10 bg-gray-300 rounded-full animate-pulse"></div>
        <div class="flex-1 space-y-2">
          <div class="h-4 bg-gray-300 rounded animate-pulse w-1/4"></div>
          <div class="h-3 bg-gray-200 rounded animate-pulse w-1/3"></div>
        </div>
      </div>
    <% end %>
    
    <!-- Title skeleton -->
    <div class="space-y-2">
      <div class="h-5 bg-gray-300 rounded animate-pulse w-3/4"></div>
      <div class="h-4 bg-gray-200 rounded animate-pulse w-1/2"></div>
    </div>
    
    <!-- Content lines -->
    <div class="space-y-2">
      <% lines.times do |i| %>
        <% 
          # Vary the widths for more realistic skeleton
          widths = ["w-full", "w-5/6", "w-4/5", "w-3/4", "w-2/3"]
          width_class = widths[i % widths.length]
        %>
        <div class="h-4 bg-gray-200 rounded animate-pulse <%= width_class %>"></div>
      <% end %>
    </div>
    
    <!-- Button area -->
    <div class="flex space-x-2 pt-2">
      <div class="h-8 bg-gray-300 rounded animate-pulse w-20"></div>
      <div class="h-8 bg-gray-200 rounded animate-pulse w-16"></div>
    </div>
  </div>
  
  <!-- Screen reader text -->
  <span class="sr-only">Loading content, please wait...</span>
</div>