<% content_for :title, "Content Library" %>

<div class="content-library" data-controller="content-library" data-content-library-search-url-value="<%= content_repositories_path(format: :json) %>">
  <!-- Header with Search and Actions -->
  <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-8 space-y-4 lg:space-y-0">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">Content Library</h1>
      <p class="mt-2 text-gray-600">Manage and organize all your marketing content</p>
    </div>
    
    <div class="flex flex-col sm:flex-row gap-3">
      <%= link_to "Create Content", new_content_repository_path, 
          class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors" %>
      
      <button data-action="click->content-library#toggleBulkMode" 
              class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        Bulk Actions
      </button>
    </div>
  </div>

  <!-- Search and Filter Section -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
    <div class="p-6">
      <!-- Search Bar -->
      <div class="mb-6">
        <%= search_form_for @q, url: content_repositories_path, method: :get, local: true, class: "search-form" do |f| %>
          <div class="relative">
            <%= f.search_field :title_or_description_cont, 
                placeholder: "Search content by title, description, or keywords...",
                class: "block w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm",
                data: { 
                  action: "input->content-library#debounceSearch",
                  content_library_target: "searchInput"
                } %>
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
              </svg>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Filters -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <!-- Status Filter -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
          <select data-action="change->content-library#filterChanged" 
                  data-content-library-target="statusFilter"
                  class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm">
            <option value="">All Status</option>
            <% ContentRepository.statuses.each do |status, _| %>
              <option value="<%= status %>" <%= 'selected' if params.dig(:q, :status_eq) == status %>>
                <%= status.titleize %>
              </option>
            <% end %>
          </select>
        </div>

        <!-- Content Type Filter -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Content Type</label>
          <select data-action="change->content-library#filterChanged" 
                  data-content-library-target="typeFilter"
                  class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm">
            <option value="">All Types</option>
            <% ContentRepository.content_types.each do |type, _| %>
              <option value="<%= type %>" <%= 'selected' if params.dig(:q, :content_type_eq) == type %>>
                <%= type.titleize %>
              </option>
            <% end %>
          </select>
        </div>

        <!-- Format Filter -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Format</label>
          <select data-action="change->content-library#filterChanged" 
                  data-content-library-target="formatFilter"
                  class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm">
            <option value="">All Formats</option>
            <% ContentRepository.formats.each do |format, _| %>
              <option value="<%= format %>" <%= 'selected' if params.dig(:q, :format_eq) == format %>>
                <%= format.titleize %>
              </option>
            <% end %>
          </select>
        </div>

        <!-- Date Range -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Date Range</label>
          <select data-action="change->content-library#filterChanged" 
                  data-content-library-target="dateFilter"
                  class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm">
            <option value="">All Time</option>
            <option value="today">Today</option>
            <option value="week">This Week</option>
            <option value="month">This Month</option>
            <option value="quarter">This Quarter</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Stats Overview -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <div class="w-8 h-8 bg-blue-100 rounded-md flex items-center justify-center">
            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
          </div>
        </div>
        <div class="ml-4">
          <p class="text-sm font-medium text-gray-500">Total Content</p>
          <p class="text-2xl font-semibold text-gray-900"><%= @stats[:total] %></p>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <div class="w-8 h-8 bg-yellow-100 rounded-md flex items-center justify-center">
            <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
            </svg>
          </div>
        </div>
        <div class="ml-4">
          <p class="text-sm font-medium text-gray-500">In Draft</p>
          <p class="text-2xl font-semibold text-gray-900"><%= @stats[:draft] %></p>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <div class="w-8 h-8 bg-orange-100 rounded-md flex items-center justify-center">
            <svg class="w-5 h-5 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
            </svg>
          </div>
        </div>
        <div class="ml-4">
          <p class="text-sm font-medium text-gray-500">Under Review</p>
          <p class="text-2xl font-semibold text-gray-900"><%= @stats[:review] %></p>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <div class="w-8 h-8 bg-green-100 rounded-md flex items-center justify-center">
            <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
        </div>
        <div class="ml-4">
          <p class="text-sm font-medium text-gray-500">Published</p>
          <p class="text-2xl font-semibold text-gray-900"><%= @stats[:published] %></p>
        </div>
      </div>
    </div>
  </div>

  <!-- View Toggle -->
  <div class="flex justify-between items-center mb-6">
    <div class="flex items-center space-x-4">
      <p class="text-sm text-gray-700">
        Showing <span class="font-medium"><%= @content_repositories.offset + 1 %></span>
        to <span class="font-medium"><%= @content_repositories.offset + @content_repositories.length %></span>
        of <span class="font-medium"><%= @content_repositories.total_count %></span> results
      </p>
    </div>
    
    <div class="flex items-center">
      <div class="relative inline-block">
        <div class="flex bg-gray-100 rounded-lg p-1">
          <button data-action="click->content-library#setGridView" 
                  data-content-library-target="gridViewBtn"
                  class="content-library-view-btn active px-3 py-1 text-sm font-medium rounded-md transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
            </svg>
          </button>
          <button data-action="click->content-library#setListView" 
                  data-content-library-target="listViewBtn"
                  class="content-library-view-btn px-3 py-1 text-sm font-medium rounded-md transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Content Grid/List -->
  <div data-content-library-target="contentContainer">
    <!-- Grid View -->
    <div data-content-library-target="gridView" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <% @content_repositories.each do |content| %>
        <%= render 'content_card', content: content %>
      <% end %>
    </div>

    <!-- List View (initially hidden) -->
    <div data-content-library-target="listView" class="hidden">
      <div class="bg-white shadow-sm rounded-lg overflow-hidden">
        <div class="min-w-full divide-y divide-gray-200">
          <!-- Table Header -->
          <div class="bg-gray-50 px-6 py-3">
            <div class="grid grid-cols-12 gap-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              <div class="col-span-4">Title</div>
              <div class="col-span-2">Type</div>
              <div class="col-span-2">Status</div>
              <div class="col-span-2">Modified</div>
              <div class="col-span-2">Actions</div>
            </div>
          </div>
          
          <!-- Table Body -->
          <div class="bg-white divide-y divide-gray-200">
            <% @content_repositories.each do |content| %>
              <%= render 'content_row', content: content %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="mt-8">
    <%= paginate @content_repositories, theme: 'twitter_bootstrap_4' %>
  </div>

  <!-- Loading Overlay -->
  <div data-content-library-target="loadingOverlay" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4">
      <div class="flex items-center">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
        <div class="ml-4">
          <p class="text-lg font-medium text-gray-900">Loading...</p>
          <p class="text-sm text-gray-500">Updating content library</p>
        </div>
      </div>
    </div>
  </div>
</div>

<% content_for :head do %>
  <style>
    .content-library-view-btn.active {
      @apply bg-white text-gray-900 shadow-sm;
    }
    .content-library-view-btn:not(.active) {
      @apply text-gray-500 hover:text-gray-700;
    }
  </style>
<% end %>