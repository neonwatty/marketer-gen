<div class="approval-workflow-container" data-controller="approval-workflow">
  <div class="mb-6 flex items-center justify-between">
    <h2 class="text-lg font-semibold text-gray-900">Approval Workflow</h2>
    
    <!-- Workflow Actions -->
    <div class="flex items-center space-x-3">
      <% if content_repository.status == 'draft' %>
        <%= link_to "#", 
            class: "inline-flex items-center px-3 py-2 border border-yellow-300 text-sm font-medium rounded-md text-yellow-700 bg-yellow-50 hover:bg-yellow-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 transition-colors",
            data: { action: "click->approval-workflow#submitForReview" } do %>
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
          Submit for Review
        <% end %>
      <% end %>
      
      <% if content_repository.status == 'review' && can?(:approve, content_repository) %>
        <div class="flex space-x-2">
          <%= link_to "#", 
              class: "inline-flex items-center px-3 py-2 border border-green-300 text-sm font-medium rounded-md text-green-700 bg-green-50 hover:bg-green-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors",
              data: { action: "click->approval-workflow#approveContent" } do %>
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            Approve
          <% end %>
          
          <%= link_to "#", 
              class: "inline-flex items-center px-3 py-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors",
              data: { action: "click->approval-workflow#rejectContent" } do %>
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
            Reject
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Workflow Status Visualization -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Workflow Status</h3>
    
    <!-- Progress Bar -->
    <div class="relative">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center space-x-4">
          <!-- Draft Stage -->
          <div class="flex flex-col items-center">
            <div class="w-8 h-8 rounded-full flex items-center justify-center border-2 
              <%= content_repository.status == 'draft' ? 'bg-yellow-500 border-yellow-500 text-white' : 
                  ['review', 'approved', 'published'].include?(content_repository.status) ? 'bg-green-500 border-green-500 text-white' : 
                  'bg-gray-200 border-gray-300 text-gray-500' %>">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
              </svg>
            </div>
            <span class="mt-2 text-xs font-medium text-gray-700">Draft</span>
          </div>

          <!-- Connection Line -->
          <div class="flex-1 h-0.5 mx-2 
            <%= ['review', 'approved', 'published'].include?(content_repository.status) ? 'bg-green-500' : 'bg-gray-300' %>"></div>

          <!-- Review Stage -->
          <div class="flex flex-col items-center">
            <div class="w-8 h-8 rounded-full flex items-center justify-center border-2 
              <%= content_repository.status == 'review' ? 'bg-yellow-500 border-yellow-500 text-white' : 
                  ['approved', 'published'].include?(content_repository.status) ? 'bg-green-500 border-green-500 text-white' : 
                  'bg-gray-200 border-gray-300 text-gray-500' %>">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
              </svg>
            </div>
            <span class="mt-2 text-xs font-medium text-gray-700">Review</span>
          </div>

          <!-- Connection Line -->
          <div class="flex-1 h-0.5 mx-2 
            <%= ['approved', 'published'].include?(content_repository.status) ? 'bg-green-500' : 'bg-gray-300' %>"></div>

          <!-- Approved Stage -->
          <div class="flex flex-col items-center">
            <div class="w-8 h-8 rounded-full flex items-center justify-center border-2 
              <%= content_repository.status == 'approved' ? 'bg-blue-500 border-blue-500 text-white' : 
                  content_repository.status == 'published' ? 'bg-green-500 border-green-500 text-white' : 
                  'bg-gray-200 border-gray-300 text-gray-500' %>">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <span class="mt-2 text-xs font-medium text-gray-700">Approved</span>
          </div>

          <!-- Connection Line -->
          <div class="flex-1 h-0.5 mx-2 
            <%= content_repository.status == 'published' ? 'bg-green-500' : 'bg-gray-300' %>"></div>

          <!-- Published Stage -->
          <div class="flex flex-col items-center">
            <div class="w-8 h-8 rounded-full flex items-center justify-center border-2 
              <%= content_repository.status == 'published' ? 'bg-green-500 border-green-500 text-white' : 
                  'bg-gray-200 border-gray-300 text-gray-500' %>">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
              </svg>
            </div>
            <span class="mt-2 text-xs font-medium text-gray-700">Published</span>
          </div>
        </div>
      </div>

      <!-- Current Status Description -->
      <div class="mt-4 p-4 rounded-lg 
        <%= case content_repository.status
            when 'draft' then 'bg-yellow-50 border border-yellow-200'
            when 'review' then 'bg-orange-50 border border-orange-200'
            when 'approved' then 'bg-blue-50 border border-blue-200'
            when 'published' then 'bg-green-50 border border-green-200'
            when 'rejected' then 'bg-red-50 border border-red-200'
            else 'bg-gray-50 border border-gray-200'
            end %>">
        <div class="flex items-start">
          <div class="flex-shrink-0 mr-3">
            <div class="w-6 h-6 rounded-full flex items-center justify-center 
              <%= case content_repository.status
                  when 'draft' then 'bg-yellow-500'
                  when 'review' then 'bg-orange-500'
                  when 'approved' then 'bg-blue-500'
                  when 'published' then 'bg-green-500'
                  when 'rejected' then 'bg-red-500'
                  else 'bg-gray-500'
                  end %>">
              <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
              </svg>
            </div>
          </div>
          <div>
            <h4 class="text-sm font-medium 
              <%= case content_repository.status
                  when 'draft' then 'text-yellow-800'
                  when 'review' then 'text-orange-800'
                  when 'approved' then 'text-blue-800'
                  when 'published' then 'text-green-800'
                  when 'rejected' then 'text-red-800'
                  else 'text-gray-800'
                  end %>">
              <%= content_repository.status.titleize %> Status
            </h4>
            <p class="text-sm mt-1 
              <%= case content_repository.status
                  when 'draft' then 'text-yellow-700'
                  when 'review' then 'text-orange-700'
                  when 'approved' then 'text-blue-700'
                  when 'published' then 'text-green-700'
                  when 'rejected' then 'text-red-700'
                  else 'text-gray-700'
                  end %>">
              <%= case content_repository.status
                  when 'draft'
                    "Content is being created and edited. Submit for review when ready."
                  when 'review'
                    "Content is under review by stakeholders. Awaiting approval or feedback."
                  when 'approved'
                    "Content has been approved and is ready for publication."
                  when 'published'
                    "Content is live and published to the intended channels."
                  when 'rejected'
                    "Content was rejected during review. Please address feedback and resubmit."
                  else
                    "Status: #{content_repository.status}"
                  end %>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Stakeholder Assignments -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Stakeholder Assignments</h3>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- Reviewers -->
      <div>
        <h4 class="text-sm font-medium text-gray-700 mb-3">Reviewers</h4>
        <div class="space-y-2">
          <!-- This would be populated from content_permissions or a similar model -->
          <div class="flex items-center p-3 bg-gray-50 rounded-lg">
            <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center mr-3">
              <span class="text-sm font-medium text-white">JD</span>
            </div>
            <div class="flex-1">
              <p class="text-sm font-medium text-gray-900">John Doe</p>
              <p class="text-xs text-gray-500">Marketing Manager</p>
            </div>
            <span class="text-xs px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full">Pending</span>
          </div>
          
          <div class="flex items-center p-3 bg-gray-50 rounded-lg">
            <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center mr-3">
              <span class="text-sm font-medium text-white">JS</span>
            </div>
            <div class="flex-1">
              <p class="text-sm font-medium text-gray-900">Jane Smith</p>
              <p class="text-xs text-gray-500">Content Strategist</p>
            </div>
            <span class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full">Approved</span>
          </div>
        </div>
      </div>

      <!-- Approvers -->
      <div>
        <h4 class="text-sm font-medium text-gray-700 mb-3">Final Approvers</h4>
        <div class="space-y-2">
          <div class="flex items-center p-3 bg-gray-50 rounded-lg">
            <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center mr-3">
              <span class="text-sm font-medium text-white">MB</span>
            </div>
            <div class="flex-1">
              <p class="text-sm font-medium text-gray-900">Mike Brown</p>
              <p class="text-xs text-gray-500">VP Marketing</p>
            </div>
            <span class="text-xs px-2 py-1 bg-gray-100 text-gray-800 rounded-full">Not Started</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Approval History -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Approval History</h3>
    
    <% if approvals.any? %>
      <div class="space-y-4">
        <% approvals.each do |approval| %>
          <div class="border-l-4 pl-4 
            <%= approval.status == 'approved' ? 'border-green-400 bg-green-50' : 
                approval.status == 'rejected' ? 'border-red-400 bg-red-50' : 
                'border-yellow-400 bg-yellow-50' %>">
            <div class="flex items-start justify-between">
              <div class="flex-1">
                <div class="flex items-center space-x-2">
                  <div class="w-6 h-6 rounded-full flex items-center justify-center 
                    <%= approval.status == 'approved' ? 'bg-green-500' : 
                        approval.status == 'rejected' ? 'bg-red-500' : 
                        'bg-yellow-500' %>">
                    <% if approval.status == 'approved' %>
                      <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                      </svg>
                    <% elsif approval.status == 'rejected' %>
                      <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                      </svg>
                    <% else %>
                      <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3"></path>
                      </svg>
                    <% end %>
                  </div>
                  
                  <h4 class="text-sm font-medium text-gray-900">
                    <%= approval.user.display_name %>
                    <span class="font-normal 
                      <%= approval.status == 'approved' ? 'text-green-700' : 
                          approval.status == 'rejected' ? 'text-red-700' : 
                          'text-yellow-700' %>">
                      <%= approval.status.titleize.downcase %>d this content
                    </span>
                  </h4>
                </div>
                
                <% if approval.comments.present? %>
                  <p class="mt-2 text-sm text-gray-600"><%= approval.comments %></p>
                <% end %>
                
                <p class="mt-1 text-xs text-gray-500">
                  <%= approval.created_at.strftime("%B %d, %Y at %I:%M %p") %>
                  <% if approval.content_version %>
                    â€¢ Version <%= approval.content_version.version_number %>
                  <% end %>
                </p>
              </div>
              
              <div class="flex-shrink-0 ml-4">
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium 
                  <%= approval.status == 'approved' ? 'bg-green-100 text-green-800' : 
                      approval.status == 'rejected' ? 'bg-red-100 text-red-800' : 
                      'bg-yellow-100 text-yellow-800' %>">
                  <%= approval.status.titleize %>
                </span>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="text-center py-8 text-gray-500">
        <svg class="w-12 h-12 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <h4 class="text-lg font-medium text-gray-900 mb-2">No approvals yet</h4>
        <p class="text-gray-500">Submit this content for review to start the approval process.</p>
      </div>
    <% end %>
  </div>
</div>

<!-- Approval Modal -->
<div data-approval-workflow-target="approvalModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 z-50 flex items-center justify-center">
  <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
    <h3 class="text-lg font-semibold text-gray-900 mb-4" data-approval-workflow-target="modalTitle">
      Approve Content
    </h3>
    
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700 mb-2">Comments</label>
      <textarea data-approval-workflow-target="commentsField" 
                rows="3" 
                class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                placeholder="Add your feedback (optional)..."></textarea>
    </div>
    
    <div class="flex justify-end space-x-3">
      <button data-action="click->approval-workflow#closeModal" 
              class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
        Cancel
      </button>
      <button data-action="click->approval-workflow#submitApproval" 
              data-approval-workflow-target="submitButton"
              class="px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors">
        Approve
      </button>
    </div>
  </div>
</div>