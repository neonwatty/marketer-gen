<h2>Daily Activity Report</h2>
<p>Date: <%= @date.strftime('%B %d, %Y') %></p>

<h3>Summary</h3>
<table style="width: 100%; border-collapse: collapse;">
  <tr>
    <td style="padding: 8px; border: 1px solid #ddd;">Total Activities</td>
    <td style="padding: 8px; border: 1px solid #ddd;"><%= @report[:summary][:total_activities] %></td>
  </tr>
  <tr>
    <td style="padding: 8px; border: 1px solid #ddd;">Average per Hour</td>
    <td style="padding: 8px; border: 1px solid #ddd;"><%= (@report[:summary][:total_activities] / 24.0).round(2) %></td>
  </tr>
  <tr>
    <td style="padding: 8px; border: 1px solid #ddd;">Failed Requests</td>
    <td style="padding: 8px; border: 1px solid #ddd;"><%= @report[:summary][:failed_requests] %></td>
  </tr>
  <tr>
    <td style="padding: 8px; border: 1px solid #ddd;">Suspicious Activities</td>
    <td style="padding: 8px; border: 1px solid #ddd; color: <%= @report[:summary][:suspicious_count] > 0 ? 'red' : 'green' %>;"><%= @report[:summary][:suspicious_count] %></td>
  </tr>
  <tr>
    <td style="padding: 8px; border: 1px solid #ddd;">Unique IP Addresses</td>
    <td style="padding: 8px; border: 1px solid #ddd;"><%= @report[:summary][:unique_ips] %></td>
  </tr>
</table>

<% if @report[:security_events].any? %>
  <h3 style="color: red;">Security Events</h3>
  <ul>
    <% @report[:security_events].each do |event| %>
      <li>
        <strong><%= event[:type].humanize %>:</strong> <%= event[:count] %> occurrences
        <% if event[:last_attempt] %>
          (last: <%= event[:last_attempt].strftime('%I:%M %p') %>)
        <% end %>
      </li>
    <% end %>
  </ul>
<% end %>

<% if @report[:recommendations].any? %>
  <h3>Recommendations</h3>
  <ul>
    <% @report[:recommendations].each do |rec| %>
      <li><%= rec[:message] %> (Priority: <%= rec[:priority] %>)</li>
    <% end %>
  </ul>
<% end %>

<h3>Top Activities</h3>
<table style="width: 100%; border-collapse: collapse;">
  <tr>
    <th style="padding: 8px; border: 1px solid #ddd; text-align: left;">Action</th>
    <th style="padding: 8px; border: 1px solid #ddd; text-align: right;">Count</th>
    <th style="padding: 8px; border: 1px solid #ddd; text-align: right;">Percentage</th>
  </tr>
  <% @report[:activity_breakdown].first(10).each do |activity| %>
    <tr>
      <td style="padding: 8px; border: 1px solid #ddd;"><%= activity[:controller] %>#<%= activity[:action] %></td>
      <td style="padding: 8px; border: 1px solid #ddd; text-align: right;"><%= activity[:count] %></td>
      <td style="padding: 8px; border: 1px solid #ddd; text-align: right;"><%= activity[:percentage] %>%</td>
    </tr>
  <% end %>
</table>

<% if @report[:performance_metrics][:slowest_actions]&.any? %>
  <h3>Slowest Actions</h3>
  <table style="width: 100%; border-collapse: collapse;">
    <tr>
      <th style="padding: 8px; border: 1px solid #ddd; text-align: left;">Action</th>
      <th style="padding: 8px; border: 1px solid #ddd; text-align: right;">Response Time</th>
    </tr>
    <% @report[:performance_metrics][:slowest_actions].first(5).each do |action| %>
      <tr>
        <td style="padding: 8px; border: 1px solid #ddd;"><%= action[:action] %></td>
        <td style="padding: 8px; border: 1px solid #ddd; text-align: right;"><%= action[:response_time_ms] %>ms</td>
      </tr>
    <% end %>
  </table>
<% end %>

<p style="margin-top: 30px;">
  <%= link_to "View Full Report", activity_report_url %>
</p>